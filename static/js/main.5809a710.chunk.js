(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{37:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(1),s=n.n(r),c=n(17),i=n.n(c),o=n(4),u=n(23),l=n(2),m=n.n(l),j=n(6),p=n(18),d=n(19),h=n(20),b=n(24),x=n(22),g=(n(31),n(3)),f={host:"https://imagebook-backend.herokuapp.com/api"},v=function(){var e=Object(j.a)(m.a.mark((function e(t){var n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return n=e.sent,e.next=5,n.json();case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=Object(j.a)(m.a.mark((function e(t,n){var a,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}});case 2:return a=e.sent,e.next=5,a.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=Object(j.a)(m.a.mark((function e(t,n){var a,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 2:return a=e.sent,e.next=5,a.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),k=function(){var e=Object(j.a)(m.a.mark((function e(t,n,a,r){var s,c,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r?JSON.stringify(n):n,e.next=3,fetch(t,{method:"POST",headers:{Accept:"application/json",Authorization:"Bearer "+a},body:s});case 3:return c=e.sent,e.next=6,c.json();case 6:return i=e.sent,e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),y=function(){var e=Object(j.a)(m.a.mark((function e(t,n){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"DELETE",headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"}});case 2:return a=e.sent,e.next=5,a.json();case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function w(e){var t=e.is_authenticated,n=e.logout;return Object(a.jsx)("div",{children:Object(a.jsxs)("nav",{className:"navbar navbar-expand-lg navbar-dark bg-primary",children:[Object(a.jsx)(o.b,{className:"navbar-brand ml-4 mb-1",to:"/home",children:"Imagebook"}),Object(a.jsx)("ul",{className:"navbar-nav ml-4",children:Object(a.jsx)("li",{className:"nav-item active",children:Object(a.jsx)(o.b,{className:"nav-link",to:"/home",children:"Home"})})}),Object(a.jsx)("div",{style:{position:"absolute",right:"3rem"},children:Object(a.jsxs)("ul",{className:"navbar-nav",children:[Object(a.jsx)("li",{className:"nav-item active",children:t&&Object(a.jsx)(o.b,{className:"nav-link",to:"/upload",children:"Upload"})}),Object(a.jsx)("li",{className:"nav-item active",children:t?Object(a.jsx)(o.b,{className:"nav-link",to:"/repo",children:"Repo"}):Object(a.jsx)(o.b,{className:"nav-link",to:"/signup",children:"Signup"})}),Object(a.jsx)("li",{className:"nav-item active",children:t?Object(a.jsx)(o.b,{className:"nav-link",onClick:n,to:"/",children:"Logout"}):Object(a.jsx)(o.b,{className:"nav-link",to:"/login",children:"Login"})})]})})]})})}function N(e){var t,n=e.image;return Object(a.jsx)("div",{className:"mb-2",children:Object(a.jsx)(o.b,{to:"/image/".concat(n.posted_by._id,"/").concat(n._id),children:Object(a.jsx)("img",{src:"data:".concat(n.image.contentType,";base64,").concat((t=n.image.data.data,btoa(t.reduce((function(e,t){return e+String.fromCharCode(t)}),"")))),alt:"",width:"350rem",height:"200rem"})})})}function S(e){var t,n=e.user,r=e.images,s="";return n&&r&&r.map?(t=r.map((function(e){return Object(a.jsx)("div",{className:"col-3",children:Object(a.jsx)(N,{image:e},e._id)},e._id)})),s=n.username):t=Object(a.jsx)("div",{}),Object(a.jsxs)("div",{className:"mt-4 mb-4 ml-4",children:[Object(a.jsx)("h3",{children:s}),Object(a.jsx)("div",{className:"row",children:t})]})}function C(e){var t,n=e.users,r=e.images;return t=n&&r&&Object.keys(r).map?Object.keys(n).map((function(e){return Object(a.jsx)(S,{user:n[e],images:r[e]},e)})):Object(a.jsx)("div",{}),Object(a.jsx)("div",{className:"mt-3",children:t})}function I(e){var t=e.username,n=e.password,r=e.text_input_change,s=e.login;return Object(a.jsx)("div",{className:"mt-5",children:Object(a.jsxs)("form",{className:"w-25 m-auto",children:[Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{htmlFor:"username",children:"Username"}),Object(a.jsx)("input",{type:"text",className:"form-control",name:"username",id:"username",placeholder:"Bruce Wayne",value:t,onChange:r})]}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{htmlFor:"password",children:"Password"}),Object(a.jsx)("input",{type:"password",className:"form-control",id:"password",name:"password",value:n,onChange:r}),Object(a.jsxs)("small",{className:"form-text text-muted",children:["Don't have an account? ",Object(a.jsx)(o.b,{to:"/signup",children:"Signup"})]})]}),Object(a.jsx)("button",{type:"submit",className:"btn btn-primary",onClick:s,children:"Login"})]})})}function D(e){var t=e.username,n=e.password,r=e.text_input_change,s=e.signup;return Object(a.jsx)("div",{className:"mt-5",children:Object(a.jsxs)("form",{className:"w-25 m-auto",children:[Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{htmlFor:"username",children:"Username"}),Object(a.jsx)("input",{type:"text",className:"form-control",name:"username",id:"username",placeholder:"Bruce Wayne",value:t,onChange:r})]}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{htmlFor:"password",children:"Password"}),Object(a.jsx)("input",{type:"password",className:"form-control",id:"password",name:"password",value:n,onChange:r}),Object(a.jsxs)("small",{className:"form-text text-muted",children:["Don't have an account? ",Object(a.jsx)(o.b,{to:"/login",children:"Login"})]})]}),Object(a.jsx)("button",{type:"submit",className:"btn btn-primary",onClick:s,children:"Signup"})]})})}var T=Object(g.h)((function(e){var t,n=e.images,r=e.users,s=e.cur_user,c=e.delete_image,i=Object(g.g)(),o=i.userId,u=i.imageId;try{var l=r[o],m=n[o].filter((function(e){return e._id===u}));return m=m[0],Object(a.jsx)("div",{className:"mt-3",children:Object(a.jsxs)("div",{className:"row",children:[Object(a.jsx)("div",{className:"col-8",children:Object(a.jsx)("img",{src:"data:".concat(m.image.contentType,";base64,").concat((t=m.image.data.data,btoa(t.reduce((function(e,t){return e+String.fromCharCode(t)}),"")))),alt:"",width:"1000rem",height:"600rem"})}),Object(a.jsxs)("div",{className:"col-4",children:[Object(a.jsx)("div",{style:{fontWeight:"bold"},children:l.username}),Object(a.jsx)("div",{style:{color:"gray"},children:"@".concat(m.created)}),Object(a.jsx)("div",{className:"mt-3",children:m.title}),Object(a.jsx)("div",{className:"mt-3",children:m.posted_by._id===s&&Object(a.jsx)("button",{className:"btn btn-danger",onClick:function(){return c(o,u)},children:"Delete"})})]})]})})}catch(j){return Object(a.jsx)(g.a,{to:"/repo"})}})),F=function(){var e=Object(j.a)(m.a.mark((function e(t,n,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a(t);case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:return e.prev=7,n.push("/repo"),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[0,5,7,10]])})));return function(t,n,a){return e.apply(this,arguments)}}();var A=Object(g.h)((function(e){var t=e.type,n=e.title,r=e.image,s=e.text_input_change,c=e.upload_image,i=e.history;return Object(a.jsx)("div",{className:"mt-5",children:Object(a.jsxs)("form",{className:"w-25 m-auto",children:[Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{htmlFor:"title",children:"Title"}),Object(a.jsx)("input",{type:"text",className:"form-control",name:"title",id:"title",placeholder:"A beautiful image",value:n,onChange:s})]}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{htmlFor:"type",children:"Image Status"}),Object(a.jsxs)("select",{className:"form-control",id:"type",name:"type",value:t,onChange:s,children:[Object(a.jsx)("option",{value:"public",children:"public"}),Object(a.jsx)("option",{value:"private",children:"private"})]})]}),Object(a.jsxs)("div",{className:"form-group",children:[Object(a.jsx)("label",{htmlFor:"image",children:"Image"}),Object(a.jsx)("input",{type:"file",className:"form-control-file",id:"image",name:"image",ref:r})]}),Object(a.jsx)("button",{type:"submit",className:"btn btn-primary",onClick:function(e){return F(e,i,c)},children:"Upload"})]})})})),B=function(e){Object(b.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).text_input_change=function(e){var t=e.target;a.setState(Object(p.a)({},t.name,t.value))},a.upload_image=function(){var e=Object(j.a)(m.a.mark((function e(t){var n,r,s,c,i,o,u,l,j,p;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=a.state,r=n.title,s=n.type,c=n.image,i=n.images,o=n.current_user,u=n.token,(l=new FormData).append("title",r),l.append("status",s),l.append("image",c.current.files[0]),j="".concat(f.host,"/image/new/").concat(o),e.next=9,k(j,l,u,!1);case 9:p=e.sent,i[o].push(p),a.setState({images:i});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.fetch_all_users=Object(j.a)(m.a.mark((function e(){var t,n,r,s,c,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(f.host,"/user"),e.next=3,v(t);case 3:n=e.sent,r={},s=Object(u.a)(n);try{for(s.s();!(c=s.n()).done;)i=c.value,o=i._id,r[o]=i}catch(l){s.e(l)}finally{s.f()}a.setState({users:r});case 8:case"end":return e.stop()}}),e)}))),a.fetch_all_images=Object(j.a)(m.a.mark((function e(){var t,n,r,s,c,i,o,u,l,j,p,d;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state.users,n=sessionStorage.getItem("token"),r="".concat(f.host,"/image/"),s={},!n){e.next=17;break}c=0,i=Object.keys(t);case 6:if(!(c<i.length)){e.next=15;break}return o=i[c],e.next=10,O(r+o,n);case 10:u=e.sent,s[o]=u;case 12:c++,e.next=6;break;case 15:e.next=27;break;case 17:l=0,j=Object.keys(t);case 18:if(!(l<j.length)){e.next=27;break}return p=j[l],e.next=22,v(r+p);case 22:d=e.sent,s[p]=d;case 24:l++,e.next=18;break;case 27:a.setState({images:s});case 28:case"end":return e.stop()}}),e)}))),a.delete_an_image=function(){var e=Object(j.a)(m.a.mark((function e(t,n){var r,s,c,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.state,s=r.images,c=r.token,i="".concat(f.host,"/image/").concat(n),e.next=4,y(i,c);case 4:o=s[t].filter((function(e){return e._id!==n})),s[t]=o,a.setState({images:s});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.signup_or_login=function(){var e=Object(j.a)(m.a.mark((function e(t){var n,r,s,c,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state,r=n.username,s=n.password,0!==r.length&&0!==s.length){e.next=3;break}return e.abrupt("return");case 3:return c="".concat(f.host,"/").concat(t),i={username:r,password:s},e.next=7,_(c,i);case 7:return o=e.sent,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.signup=function(){var e=Object(j.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,a.signup_or_login("user");case 3:if((n=e.sent)&&!n.error){e.next=7;break}return alert("Signup failed"),e.abrupt("return");case 7:a.setState({is_new:!1});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.login=function(){var e=Object(j.a)(m.a.mark((function e(t){var n,r,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,a.signup_or_login("signin");case 3:if((n=e.sent)&&!n.error){e.next=7;break}return alert("Login failed"),e.abrupt("return");case 7:return r=n.token,s=n.user._id,sessionStorage.setItem("token",r),sessionStorage.setItem("user",s),a.setState({token:r,current_user:s,is_authenticated:!0}),e.next=14,a.fetch_all_users();case 14:return e.next=16,a.fetch_all_images();case 16:console.log(a.state);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.logout=function(e){e.preventDefault(),sessionStorage.getItem("token")&&(sessionStorage.removeItem("token"),sessionStorage.removeItem("user")),a.setState({token:"",is_authenticated:!1,current_user:"",users:{},images:{}}),console.log(a.state)},a.state={username:"",password:"",is_authenticated:!1,is_new:!0,token:"",current_user:"",users:{},images:{},image:s.a.createRef(),type:"public",title:""},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=Object(j.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return sessionStorage.getItem("token")&&this.setState({is_authenticated:!0,token:sessionStorage.getItem("token")}),sessionStorage.getItem("user")&&this.setState({current_user:sessionStorage.getItem("user")}),e.next=4,this.fetch_all_users();case 4:return e.next=6,this.fetch_all_images();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.username,n=e.password,r=e.is_authenticated,s=e.is_new,c=e.users,i=e.images,o=e.current_user,u=e.type,l=e.image,m=e.title;return Object(a.jsxs)("div",{className:"App",children:[Object(a.jsx)("div",{children:Object(a.jsx)(w,{is_authenticated:r,logout:this.logout})}),Object(a.jsx)("div",{className:"container-fluid",children:Object(a.jsxs)(g.d,{children:[Object(a.jsx)(g.b,{exact:!0,path:["/","/login"],children:r?Object(a.jsx)(g.a,{to:"/repo"}):Object(a.jsx)(I,{username:t,password:n,text_input_change:this.text_input_change,login:this.login})}),Object(a.jsx)(g.b,{path:"/home",children:r?Object(a.jsx)(C,{users:c,images:i}):Object(a.jsx)(g.a,{to:"/login"})}),Object(a.jsx)(g.b,{path:"/signup",children:s?Object(a.jsx)(D,{username:t,password:n,text_input_change:this.text_input_change,signup:this.signup}):Object(a.jsx)(g.a,{to:"/login"})}),Object(a.jsx)(g.b,{path:"/repo",children:r?Object(a.jsx)(S,{user:c[o],images:i[o]}):Object(a.jsx)(g.a,{to:"/login"})}),Object(a.jsx)(g.b,{path:"/image/:userId/:imageId",children:r?Object(a.jsx)(T,{users:c,images:i,cur_user:o,delete_image:this.delete_an_image}):Object(a.jsx)(g.a,{to:"/login"})}),Object(a.jsx)(g.b,{path:"/upload",children:r?Object(a.jsx)(A,{type:u,image:l,title:m,text_input_change:this.text_input_change,upload_image:this.upload_image}):Object(a.jsx)(g.a,{to:"/login"})})]})})]})}}]),n}(r.Component);i.a.render(Object(a.jsx)(o.a,{children:Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(B,{})})}),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.5809a710.chunk.js.map